{# app/templates/transactions/partials/_filters.html - Desktop sidebar filters #}
<form id="desktop-filter-form"
      hx-get="/transactions"
      hx-target="#results-container"
      hx-indicator="#loading-indicator"
      hx-trigger="change"
      class="space-y-4">
  
  {# Account #}
  <div class="form-control">
    <label class="label" for="filter-account">
      <span class="label-text font-medium">Account</span>
    </label>
    <select name="account_id" 
            id="filter-account"
            class="select select-bordered select-sm w-full"
            hx-get="/api/v1/accounts/{value}/cards"
            hx-target="#filter-card">
      <option value="">All accounts</option>
      {% for account in accounts %}
      <option value="{{ account.id }}" 
              {% if filters.account_id == account.id %}selected{% endif %}>
        {{ account.institution }} • {{ account.name }}
      </option>
      {% endfor %}
    </select>
  </div>

  {# Card #}
  <div class="form-control">
    <label class="label" for="filter-card">
      <span class="label-text font-medium">Card</span>
    </label>
    <select name="card_id" 
            id="filter-card"
            class="select select-bordered select-sm w-full"
            {% if not cards or cards|length == 0 %}disabled{% endif %}>
      <option value="">All cards</option>
      {% for card in cards %}
      <option value="{{ card.id }}"
              {% if filters.card_id == card.id %}selected{% endif %}>
        {{ card.name }} • ****{{ card.card_masked_number[-4:] }}
      </option>
      {% endfor %}
    </select>
    {% if not cards or cards|length == 0 %}
    <label class="label">
      <span class="label-text-alt text-base-content/50">Select an account first</span>
    </label>
    {% endif %}
  </div>

  {# Period Presets #}
  <div class="form-control">
    <label class="label">
      <span class="label-text font-medium">Period</span>
    </label>
    <div class="join join-vertical w-full">
      <button type="button" 
              class="btn join-item btn-sm justify-start {% if period_preset == 'today' %}btn-primary{% else %}btn-ghost{% endif %}"
              hx-get="/transactions"
              hx-vals='{"period_preset": "today"}'
              hx-include="#desktop-filter-form"
              hx-target="#results-container">
        Today
      </button>
      <button type="button" 
              class="btn join-item btn-sm justify-start {% if period_preset == 'week' %}btn-primary{% else %}btn-ghost{% endif %}"
              hx-get="/transactions"
              hx-vals='{"period_preset": "week"}'
              hx-include="#desktop-filter-form"
              hx-target="#results-container">
        This Week
      </button>
      <button type="button" 
              class="btn join-item btn-sm justify-start {% if period_preset == 'month' %}btn-primary{% else %}btn-ghost{% endif %}"
              hx-get="/transactions"
              hx-vals='{"period_preset": "month"}'
              hx-include="#desktop-filter-form"
              hx-target="#results-container">
        This Month
      </button>
      <button type="button" 
              class="btn join-item btn-sm justify-start {% if period_preset == 'custom' %}btn-primary{% else %}btn-ghost{% endif %}"
              onclick="document.getElementById('custom-dates').classList.toggle('hidden')">
        Custom Range
      </button>
    </div>
  </div>

  {# Custom Date Range #}
  <div id="custom-dates" class="form-control {% if period_preset != 'custom' %}hidden{% endif %}">
    <div class="grid grid-cols-2 gap-2">
      <div>
        <label class="label" for="filter-date-from">
          <span class="label-text text-xs">From</span>
        </label>
        <input type="date" 
               name="date_from" 
               id="filter-date-from"
               value="{{ filters.date_from or '' }}"
               class="input input-bordered input-sm w-full" />
      </div>
      <div>
        <label class="label" for="filter-date-to">
          <span class="label-text text-xs">To</span>
        </label>
        <input type="date" 
               name="date_to" 
               id="filter-date-to"
               value="{{ filters.date_to or '' }}"
               class="input input-bordered input-sm w-full" />
      </div>
    </div>
  </div>

  {# Search #}
  <div class="form-control">
    <label class="label" for="filter-search">
      <span class="label-text font-medium">Search</span>
    </label>
    <input type="search" 
           name="q" 
           id="filter-search"
           placeholder="Description, amount..."
           value="{{ filters.q or '' }}"
           class="input input-bordered input-sm w-full"
           hx-get="/transactions"
           hx-trigger="keyup changed delay:300ms"
           hx-include="#desktop-filter-form"
           hx-target="#results-container" />
  </div>

  {# Transaction Kind #}
  <div class="form-control">
    <label class="label" for="filter-kind">
      <span class="label-text font-medium">Kind</span>
    </label>
    <select name="kind" 
            id="filter-kind"
            class="select select-bordered select-sm w-full">
      <option value="">All kinds</option>
      <option value="purchase" {% if filters.kind == 'purchase' %}selected{% endif %}>Purchase</option>
      <option value="topup" {% if filters.kind == 'topup' %}selected{% endif %}>Top-up</option>
      <option value="refund" {% if filters.kind == 'refund' %}selected{% endif %}>Refund</option>
      <option value="other" {% if filters.kind == 'other' %}selected{% endif %}>Other</option>
    </select>
  </div>

  {# Direction #}
  <div class="form-control">
    <label class="label">
      <span class="label-text font-medium">Direction</span>
    </label>
    <div class="flex gap-2">
      <label class="flex items-center gap-1 cursor-pointer">
        <input type="radio" 
               name="direction" 
               value="" 
               class="radio radio-sm"
               {% if not filters.direction %}checked{% endif %} />
        <span class="text-sm">All</span>
      </label>
      <label class="flex items-center gap-1 cursor-pointer">
        <input type="radio" 
               name="direction" 
               value="out" 
               class="radio radio-sm"
               {% if filters.direction == 'out' %}checked{% endif %} />
        <span class="text-sm">Out</span>
      </label>
      <label class="flex items-center gap-1 cursor-pointer">
        <input type="radio" 
               name="direction" 
               value="in" 
               class="radio radio-sm"
               {% if filters.direction == 'in' %}checked{% endif %} />
        <span class="text-sm">In</span>
      </label>
    </div>
  </div>

  {# Amount Range #}
  <div class="form-control">
    <label class="label">
      <span class="label-text font-medium">Amount Range</span>
    </label>
    <div class="grid grid-cols-2 gap-2">
      <fieldset class="validator">
        <input type="number" 
               name="min_amount" 
               placeholder="Min"
               value="{{ filters.min_amount or '' }}"
               step="0.01"
               class="input input-bordered input-sm w-full" />
        <div class="validator-hint">Enter valid amount</div>
      </fieldset>
      <fieldset class="validator">
        <input type="number" 
               name="max_amount" 
               placeholder="Max"
               value="{{ filters.max_amount or '' }}"
               step="0.01"
               class="input input-bordered input-sm w-full" />
        <div class="validator-hint">Enter valid amount</div>
      </fieldset>
    </div>
  </div>

  {# Currency #}
  <div class="form-control">
    <label class="label" for="filter-currency">
      <span class="label-text font-medium">Currency</span>
    </label>
    <select name="currency" 
            id="filter-currency"
            class="select select-bordered select-sm w-full">
      <option value="">All currencies</option>
      {% for curr in currencies %}
      <option value="{{ curr }}" {% if filters.currency == curr %}selected{% endif %}>{{ curr }}</option>
      {% endfor %}
    </select>
  </div>

  {# Actions #}
  <div class="flex gap-2 pt-2">
    <button type="submit" class="btn btn-primary btn-sm flex-1">Apply</button>
    <button type="button" 
            class="btn btn-ghost btn-sm"
            hx-get="/transactions"
            hx-vals='{"reset": "true"}'
            hx-target="#results-container">
      Reset
    </button>
  </div>
</form>
